<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RIKU: test/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RIKU
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A Reflection Interface that&#39;s Kinda Useful</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">test/main.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;RIKU.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>Base</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> i = 32;</div><div class="line">  <span class="keyword">typedef</span> <a name="_a0"></a><a class="code" href="structriku_1_1var.html">riku::var&lt;Base&gt;</a> Handle;</div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> DoStuff(std::string)<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">  }</div><div class="line">  <span class="keywordtype">bool</span> IsStuff()<span class="keyword"> const</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordtype">int</span>&amp; Get() { <span class="keywordflow">return</span> i; }</div><div class="line">  <span class="keywordtype">void</span> Set(<span class="keywordtype">int</span> <span class="keyword">const</span>&amp; j) { i = j; }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Derived : <span class="keyword">public</span> Base</div><div class="line">{</div><div class="line">  <span class="keyword">typedef</span> <a class="code" href="structriku_1_1var.html">riku::var&lt;Derived&gt;</a> Handle;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Sub : <span class="keyword">public</span> Derived</div><div class="line">{</div><div class="line">  <span class="keyword">typedef</span> <a class="code" href="structriku_1_1var.html">riku::var&lt;Sub&gt;</a> Handle;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Sib : <span class="keyword">public</span> Base</div><div class="line">{</div><div class="line">  <span class="keyword">typedef</span> <a class="code" href="structriku_1_1var.html">riku::var&lt;Sib&gt;</a> Handle;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Outer</div><div class="line">{</div><div class="line">  Base b;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Targs&gt; <span class="keyword">struct </span>ArgStack;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">struct </span>ArgStack&lt;T&gt; {</div><div class="line">  T val;</div><div class="line">  <span class="keywordtype">bool</span> next;</div><div class="line">};</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Targs&gt;</div><div class="line"><span class="keyword">struct </span>ArgStack&lt;T, Targs...&gt; {</div><div class="line">  T val;</div><div class="line">  <span class="keyword">typename</span> ArgStack&lt;Targs...&gt; next;</div><div class="line">};</div><div class="line"></div><div class="line">rkTemplatedType(ArgStack, <a name="a1"></a><a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a> <a name="a2"></a><a class="code" href="group__registration.html#gaaa771c9a37cc5c8064a4aad70651f5ba">rkMember</a>(val) <a class="code" href="group__registration.html#gaaa771c9a37cc5c8064a4aad70651f5ba">rkMember</a>(next))</div><div class="line"></div><div class="line"><a name="a3"></a><a class="code" href="group__registration.html#gabdad8181a7559c016b93e63bfe45c1e2">rkType</a>(Base,</div><div class="line">  <a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a></div><div class="line">  <a class="code" href="group__registration.html#gaaa771c9a37cc5c8064a4aad70651f5ba">rkMember</a>(i)</div><div class="line">  <a name="a4"></a><a class="code" href="group__registration.html#ga409e21281cdb2fc255d1619641c3535b">rkMethod</a>(DoStuff)</div><div class="line">  <a class="code" href="group__registration.html#ga409e21281cdb2fc255d1619641c3535b">rkMethod</a>(IsStuff)</div><div class="line">  <a class="code" href="group__registration.html#ga409e21281cdb2fc255d1619641c3535b">rkMethod</a>(Get)</div><div class="line">  <a class="code" href="group__registration.html#ga409e21281cdb2fc255d1619641c3535b">rkMethod</a>(Set)</div><div class="line">  <a name="a5"></a><a class="code" href="group__registration.html#ga0703d296b0b067a0e33f487209b564f2">rkGetSet</a>(Eye, Get, Set)</div><div class="line">)</div><div class="line"></div><div class="line"><a class="code" href="group__registration.html#gabdad8181a7559c016b93e63bfe45c1e2">rkType</a>(Derived,</div><div class="line">  <a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a></div><div class="line">  <a name="a6"></a><a class="code" href="group__registration.html#ga440bd002568644098f31bcc2d8f6c3e2">rkParent</a>(Base)</div><div class="line">  <a name="a7"></a><a class="code" href="group__registration.html#ga05703248fdeaf644ec80881ca50c5e32">rkInlineGetSet</a>(Eye,</div><div class="line">    [](Derived&amp; obj) -&gt; <span class="keywordtype">int</span>&amp; {</div><div class="line">      <span class="keywordflow">return</span> obj.i;</div><div class="line">    },</div><div class="line">    [](<a name="_a8"></a><a class="code" href="structriku_1_1variant.html">riku::variant</a> obj, <span class="keywordtype">int</span> <span class="keyword">const</span>&amp; i) {</div><div class="line">      obj[<span class="stringliteral">&quot;i&quot;</span>] &lt;&lt; i;</div><div class="line">    }</div><div class="line">  )</div><div class="line">)</div><div class="line"></div><div class="line"><a class="code" href="group__registration.html#gabdad8181a7559c016b93e63bfe45c1e2">rkType</a>(Sub,</div><div class="line">  <a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a></div><div class="line">  <a class="code" href="group__registration.html#ga440bd002568644098f31bcc2d8f6c3e2">rkParent</a>(Derived)</div><div class="line">)</div><div class="line"></div><div class="line"><a class="code" href="group__registration.html#gabdad8181a7559c016b93e63bfe45c1e2">rkType</a>(Sib,</div><div class="line">  <a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a></div><div class="line">  <a class="code" href="group__registration.html#ga440bd002568644098f31bcc2d8f6c3e2">rkParent</a>(Base)</div><div class="line">  <a class="code" href="group__registration.html#ga05703248fdeaf644ec80881ca50c5e32">rkInlineGetSet</a>(Eye,</div><div class="line">    [](<a name="_a9"></a><a class="code" href="classriku_1_1variant__type.html">riku::variant_type</a> <span class="keyword">const</span>&amp; obj) -&gt; <span class="keywordtype">int</span>&amp; {</div><div class="line">      <span class="keywordflow">return</span> obj[<span class="stringliteral">&quot;i&quot;</span>].<a name="a10"></a>as&lt;<span class="keywordtype">int</span>&gt;();</div><div class="line">    },</div><div class="line">    [](Sib* obj, <span class="keywordtype">int</span> <span class="keyword">const</span>&amp; i) {</div><div class="line">      obj-&gt;i = i;</div><div class="line">    }</div><div class="line">  )</div><div class="line">)</div><div class="line"></div><div class="line"><a class="code" href="group__registration.html#gabdad8181a7559c016b93e63bfe45c1e2">rkType</a>(Outer,</div><div class="line">  <a class="code" href="group__registration.html#ga112980e4665a068031c8e977f1272a01">rkDefaultFactory</a></div><div class="line">  <a class="code" href="group__registration.html#gaaa771c9a37cc5c8064a4aad70651f5ba">rkMember</a>(b)</div><div class="line">)</div><div class="line"></div><div class="line"><span class="preprocessor">#define fail_if(condition) if(condition) {__debugbreak(); return false;}</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keywordtype">bool</span> unittest_ptr(T test, T start = T())</div><div class="line">{</div><div class="line">  T obj = start;</div><div class="line">  <span class="keyword">const</span> T cobj = start;</div><div class="line"></div><div class="line">  <a name="_a11"></a><a class="code" href="structriku_1_1ptr.html">riku::ptr</a> r(obj), cr(cobj), p(&amp;obj), cp(&amp;cobj);</div><div class="line">  </div><div class="line">  *r.to&lt;T&gt;() = test;</div><div class="line">  fail_if(obj != test);</div><div class="line"></div><div class="line">  p.as&lt;T&gt;() = start;</div><div class="line">  fail_if(obj != start);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> cr.data() == NULL &amp;&amp; cp.<a name="a12"></a>data() == NULL;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keywordtype">bool</span> unittest_val(T v)</div><div class="line">{</div><div class="line">  <a name="_a13"></a><a class="code" href="structriku_1_1val.html">riku::val</a> test(riku::get&lt;T&gt;());</div><div class="line">  <span class="keyword">const</span> <a class="code" href="structriku_1_1val.html">riku::val</a> ctest(test);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(T) &gt; RIKU_MAX_VAR_SIZE)</div><div class="line">  {</div><div class="line">    fail_if(((<a class="code" href="structriku_1_1val.html">riku::val</a> <span class="keyword">const</span>&amp;)test).data() != ctest.<a name="a14"></a>data());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> fail_if(((<a class="code" href="structriku_1_1val.html">riku::val</a> <span class="keyword">const</span>&amp;)test).data() == ctest.data());</div><div class="line"></div><div class="line">  test.as&lt;T&gt;() = v;</div><div class="line">  fail_if(test.data() == ctest.data());</div><div class="line">  fail_if(ctest.as&lt;T&gt;() == v);</div><div class="line"></div><div class="line">  test.as&lt;T&gt;() = ctest.as&lt;T&gt;();</div><div class="line">  fail_if(test.data() == ctest.data());</div><div class="line">  fail_if(test.as&lt;T&gt;() != T());</div><div class="line"></div><div class="line">  test = ctest;</div><div class="line">  <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(T) &gt; RIKU_MAX_VAR_SIZE)</div><div class="line">  {</div><div class="line">    fail_if(((<a class="code" href="structriku_1_1val.html">riku::val</a> <span class="keyword">const</span>&amp;)test).data() != ctest.data());</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> fail_if(((<a class="code" href="structriku_1_1val.html">riku::val</a> <span class="keyword">const</span>&amp;)test).data() == ctest.data());</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</div><div class="line"><span class="keywordtype">bool</span> unittest_variant(T tval1, U tval2)</div><div class="line">{</div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> obj(tval1),</div><div class="line">    pobj(&amp;obj); <span class="comment">//a variant HOLDING A MOTHERFUCKING VARIANT</span></div><div class="line"></div><div class="line">  fail_if(obj.<a name="a15"></a>type() != riku::get&lt;T&gt;());</div><div class="line">  fail_if(pobj.<a name="a16"></a>type() != riku::get&lt;riku::variant&gt;());</div><div class="line"></div><div class="line">  <span class="keyword">auto</span>&amp; v = pobj.as&lt;<a class="code" href="structriku_1_1variant.html">riku::variant</a>&gt;();</div><div class="line">  fail_if(&amp;v != &amp;obj);</div><div class="line"></div><div class="line">  v = tval2;</div><div class="line">  fail_if(obj.as&lt;U&gt;() != tval2);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_varT()</div><div class="line">{</div><div class="line">  Base b;</div><div class="line">  Derived d; d.i = 75;</div><div class="line">  Sub sub; sub.i = -81;</div><div class="line">  Sib sib; sib.i = 17;</div><div class="line"></div><div class="line">  Derived::Handle h1(b),</div><div class="line">    h2(&amp;sub);</div><div class="line">  (*h2).i = -99;</div><div class="line"></div><div class="line">  fail_if(h1.data() != NULL);</div><div class="line">  fail_if(sub.i != -99);</div><div class="line"></div><div class="line">  Base::Handle bh1;</div><div class="line">  bh1 = sib;</div><div class="line">  bh1-&gt;i = 18;</div><div class="line"></div><div class="line">  fail_if(sib.i == 18);</div><div class="line">  fail_if(bh1.as&lt;Derived&gt;().i != 18);</div><div class="line"></div><div class="line">  Base::Handle bh2(bh1);</div><div class="line">  Base::Handle bh3((<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(d)));</div><div class="line"></div><div class="line">  fail_if(bh2.data() == bh1.data());</div><div class="line">  fail_if(bh3.data() != &amp;d);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_varops()</div><div class="line">{</div><div class="line">  Outer o;</div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> v(&amp;o);</div><div class="line"></div><div class="line">  <span class="keywordtype">int</span> i = v[<span class="stringliteral">&quot;b&quot;</span>][<span class="stringliteral">&quot;i&quot;</span>].as&lt;<span class="keywordtype">int</span>&gt;();</div><div class="line">  fail_if(i != 32);</div><div class="line"></div><div class="line">  v[<span class="stringliteral">&quot;b&quot;</span>][<span class="stringliteral">&quot;i&quot;</span>] &lt;&lt; -25;</div><div class="line">  fail_if(o.b.i != -25);</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> d((Derived()));</div><div class="line">  d[<span class="stringliteral">&quot;i&quot;</span>].as&lt;<span class="keywordtype">int</span>&gt;() = 19;</div><div class="line">  Sib s; s.i = -99;</div><div class="line">  d &gt;&gt; s;</div><div class="line">  fail_if(s.i != 19);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_array()</div><div class="line">{</div><div class="line">  <span class="keyword">auto</span> jumble = riku::array::create(1, 2U, std::string(<span class="stringliteral">&quot;Shpoople&quot;</span>), Outer());</div><div class="line">  <a name="_a17"></a><a class="code" href="structriku_1_1array.html">riku::array</a> copy(jumble);</div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> <span class="keyword">const</span>&amp; cc = copy;</div><div class="line"></div><div class="line">  fail_if(copy[0].type() != riku::get&lt;int&gt;());</div><div class="line">  fail_if(copy.<a name="a18"></a>get(1).type() != riku::get&lt;unsigned&gt;());</div><div class="line">  fail_if(cc[2].type() != riku::get&lt;std::string&gt;());</div><div class="line">  fail_if(cc.get(3).type() != riku::get&lt;Outer&gt;());</div><div class="line"></div><div class="line">  Base b; Derived d; Sub s1; Sib s2; Outer o;</div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> objs;</div><div class="line">  objs.<a name="a19"></a>insert(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b), 0);</div><div class="line">  objs.insert(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(d), 1);</div><div class="line">  objs.insert(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(s1), 2);</div><div class="line">  objs.insert(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(s2), 3);</div><div class="line">  objs.insert(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(o), 4);</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> blob = objs[<span class="stringliteral">&quot;i&quot;</span>]; <span class="comment">//the array of properties is returned as one variant holding that array</span></div><div class="line">                                  <span class="comment">//you can interact with it normally, or extract the internal array</span></div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> eyes = blob.as&lt;<a class="code" href="structriku_1_1array.html">riku::array</a>&gt;(); <span class="comment">//the array just holds other variants, eyes is a copy of what</span></div><div class="line">                                             <span class="comment">//blob is holding but they both still point at the memory inside objs[]</span></div><div class="line"></div><div class="line">  fail_if(eyes.<a name="a20"></a>length() != 4);  <span class="comment">//Outer doesn&#39;t have &quot;i&quot; so the new array is 1 shorter</span></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; iter : eyes) <span class="comment">//enhanced for loops work with array_var</span></div><div class="line">    fail_if(iter.as&lt;<span class="keywordtype">int</span>&gt;() != 32);</div><div class="line"></div><div class="line">  eyes.assign(<a class="code" href="structriku_1_1val.html">riku::val</a>(19));</div><div class="line">  fail_if((b.i != 19) || (d.i != 19) || (s1.i != 19) || (s2.i != 19));</div><div class="line"></div><div class="line">  fail_if(objs[<span class="stringliteral">&quot;b&quot;</span>][<span class="stringliteral">&quot;i&quot;</span>].data() != &amp;o.b.i); <span class="comment">//if there&#39;s only one element in the array it&#39;ll act as a single variant</span></div><div class="line">  fail_if(objs[4][<span class="stringliteral">&quot;b&quot;</span>][<span class="stringliteral">&quot;i&quot;</span>].data() != &amp;o.b.i); <span class="comment">//no need to extract the array from the return value of objs[&quot;b&quot;][&quot;i&quot;]</span></div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">char</span> testfunc(<span class="keywordtype">int</span>&amp; a, <span class="keywordtype">char</span> c, std::string s)</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> c;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_func()</div><div class="line">{</div><div class="line">  <a name="_a21"></a><a class="code" href="structriku_1_1function.html">riku::function</a> global(testfunc), lambda([](std::string&amp; s) {}),</div><div class="line">    basedo(&amp;Base::DoStuff), baseis(&amp;Base::IsStuff),</div><div class="line">    baseget(&amp;Base::Get), baseset(&amp;Base::Set);</div><div class="line"></div><div class="line">  fail_if(global.obj_type != NULL);</div><div class="line">  fail_if(basedo.obj_type != riku::get&lt;Base&gt;());</div><div class="line">  fail_if(lambda.obj_type != NULL);</div><div class="line"></div><div class="line">  fail_if(global.ret_type != riku::get&lt;char&gt;());</div><div class="line">  fail_if(!global.arg_list[0].is_ref);</div><div class="line">  fail_if(!basedo.is_const);</div><div class="line">  fail_if(lambda.arg_count != 1 || lambda.arg_list[0].type != riku::get&lt;std::string&gt;());</div><div class="line"></div><div class="line">  Base b; b.i = 18;</div><div class="line">  fail_if(global(<a class="code" href="structriku_1_1variant.html">riku::variant</a>(), b.i, <span class="charliteral">&#39;{&#39;</span>, std::string(<span class="stringliteral">&quot;For real?&quot;</span>)).as&lt;<span class="keywordtype">char</span>&gt;() != <span class="charliteral">&#39;{&#39;</span>);</div><div class="line">  fail_if(basedo(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b), std::string(<span class="stringliteral">&quot;ya rly&quot;</span>)).type() != NULL);</div><div class="line">  fail_if(!baseis(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b)).as&lt;bool&gt;());</div><div class="line"></div><div class="line">  fail_if(baseget(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b)).data() != &amp;b.i);</div><div class="line">  baseset(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b), 19);</div><div class="line">  fail_if(b.i != 19);</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> obj((<a class="code" href="structriku_1_1val.html">riku::val</a>(Base())));</div><div class="line">  fail_if(!obj(<span class="stringliteral">&quot;IsStuff&quot;</span>).as&lt;bool&gt;());</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_arrayfunc()</div><div class="line">{</div><div class="line">  Base b; Derived d; Sub s1; Sib s2; Outer o;</div><div class="line">  <a class="code" href="structriku_1_1variant.html">riku::variant</a> objs = <a class="code" href="structriku_1_1array.html">riku::array</a>();</div><div class="line"></div><div class="line">  objs.<a name="a22"></a>as_array()-&gt;<a name="a23"></a>push_back(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(b));</div><div class="line">  objs.as_array()-&gt;push_back(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(d));</div><div class="line">  objs.as_array()-&gt;push_back(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(s1));</div><div class="line">  objs.as_array()-&gt;push_back(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(s2));</div><div class="line">  objs.as_array()-&gt;push_back(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(o));</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> gets = objs(<span class="stringliteral">&quot;Get&quot;</span>);</div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> eyes = (*objs.as_array())[<span class="stringliteral">&quot;Eye&quot;</span>];</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; gets.length() &amp;&amp; i &lt; eyes.length(); ++i)</div><div class="line">  {</div><div class="line">    fail_if(gets[i].data() != eyes[i].data());</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1array.html">riku::array</a> func_rets = *</div><div class="line">    objs.as_array()-&gt;<a name="a24"></a>for_each(<a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(<a class="code" href="structriku_1_1function.html">riku::function</a>(</div><div class="line">      [](Base&amp; b) -&gt; std::string {</div><div class="line">        <span class="keywordflow">return</span> std::string(1, (<span class="keywordtype">char</span>)b.i);</div><div class="line">  }))).as_array();</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; iter : func_rets)</div><div class="line">  {</div><div class="line">    fail_if(iter.as&lt;std::string&gt;() != std::string(1, <span class="keywordtype">char</span>(32)));</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keywordtype">bool</span> unittest_ptrmeta()</div><div class="line">{</div><div class="line">  T* arr = <span class="keyword">new</span> T[2];</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1val.html">riku::val</a> ptr(arr);</div><div class="line">  fail_if(ptr.as&lt;T*&gt;() != arr);</div><div class="line"></div><div class="line">  <a class="code" href="structriku_1_1val.html">riku::val</a> ptr2(ptr);</div><div class="line">  fail_if(ptr2.as&lt;T*&gt;() != arr);</div><div class="line"></div><div class="line">  std::cout &lt;&lt; ptr2.<a name="a25"></a>type()-&gt;name() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="keyword">delete</span>[] arr;</div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> unittest_templatemeta()</div><div class="line">{</div><div class="line">  fail_if(riku::get&lt;<a class="code" href="structriku_1_1var.html">riku::var&lt;riku::variant_type&gt;</a> &gt;()</div><div class="line">       != riku::get&lt;<a class="code" href="structriku_1_1var.html">riku::var&lt;riku::variant_type&gt;</a> &gt;());</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> typelisttype = <span class="keyword">dynamic_cast&lt;</span><a name="_a26"></a><a class="code" href="structriku_1_1template__instance.html">riku::template_instance</a> const*<span class="keyword">&gt;</span>(riku::get&lt;riku::typelist&gt;());</div><div class="line">  <span class="keyword">auto</span> vecvartype = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="structriku_1_1template__instance.html">riku::template_instance</a> const*<span class="keyword">&gt;</span>(riku::get&lt; std::vector&lt;riku::variant&gt; &gt;());</div><div class="line">  fail_if(typelisttype == NULL);</div><div class="line">  fail_if(vecvartype == NULL);</div><div class="line">  fail_if(typelisttype-&gt;base != vecvartype-&gt;base);</div><div class="line">  fail_if(typelisttype-&gt;params.size() != 2 || vecvartype-&gt;params.size() != 2);</div><div class="line"></div><div class="line">  ArgStack&lt;int, bool, riku::typelist&gt; as3;</div><div class="line">  ArgStack&lt;std::string, float, long long, Base&gt; as4;</div><div class="line">  <span class="keyword">auto</span> as3type = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="structriku_1_1template__instance.html">riku::template_instance</a> const*<span class="keyword">&gt;</span>(riku::inspect(as3));</div><div class="line">  <span class="keyword">auto</span> as4type = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="structriku_1_1template__instance.html">riku::template_instance</a> const*<span class="keyword">&gt;</span>(riku::inspect(as4));</div><div class="line"></div><div class="line">  fail_if(as3type == NULL);</div><div class="line">  fail_if(as4type == NULL);</div><div class="line">  fail_if(as3type-&gt;base != as4type-&gt;base);</div><div class="line">  fail_if(as3type-&gt;params.size() != 3 || as4type-&gt;params.size() != 4);</div><div class="line"></div><div class="line">  fail_if(as3type-&gt;params[0] != riku::get&lt;int&gt;()</div><div class="line">       || as3type-&gt;params[1] != riku::get&lt;bool&gt;()</div><div class="line">       || as3type-&gt;params[2] != riku::get&lt;riku::typelist&gt;());</div><div class="line"></div><div class="line">  fail_if(as4type-&gt;params[0] != riku::get&lt;std::string&gt;()</div><div class="line">       || as4type-&gt;params[1] != riku::get&lt;float&gt;()</div><div class="line">       || as4type-&gt;params[2] != riku::get&lt;long long&gt;()</div><div class="line">       || as4type-&gt;params[3] != riku::get&lt;Base&gt;());</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> endval3 = <a class="code" href="structriku_1_1ptr.html">riku::ptr</a>(as3)[<span class="stringliteral">&quot;next&quot;</span>][<span class="stringliteral">&quot;next&quot;</span>][<span class="stringliteral">&quot;val&quot;</span>];</div><div class="line">  fail_if(endval3.type() != riku::get&lt;riku::typelist&gt;());</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor">#undef fail_if</span></div><div class="line"><span class="preprocessor">#define fail_if_not(condition) std::cout &lt;&lt; #condition &lt;&lt; &quot;... &quot;; if(!(condition)) { \</span></div><div class="line"><span class="preprocessor">  std::cout &lt;&lt; &quot;FAILED!!\n&quot;; system(&quot;pause&quot;); return -1;} else std::cout &lt;&lt; &quot;PASSED!!\n\n&quot;</span></div><div class="line"></div><div class="line">  fail_if_not(unittest_ptr(23));</div><div class="line">  fail_if_not(unittest_ptr(<span class="charliteral">&#39;J&#39;</span>));</div><div class="line">  fail_if_not(unittest_ptr(3.14159f));</div><div class="line">  fail_if_not(unittest_ptr&lt;unsigned short&gt;(17));</div><div class="line"></div><div class="line">  fail_if_not(unittest_val(5.3));</div><div class="line">  fail_if_not(unittest_val&lt;std::string&gt;(<span class="stringliteral">&quot;Garbanzo&quot;</span>));</div><div class="line"></div><div class="line">  fail_if_not(unittest_variant(93U, 54.3));</div><div class="line">  fail_if_not(unittest_variant(25l, <span class="charliteral">&#39;\\&#39;</span>));</div><div class="line">  fail_if_not(unittest_variant(1.618f, std::string(<span class="stringliteral">&quot;no bamboozle&quot;</span>)));</div><div class="line"></div><div class="line">  fail_if_not(unittest_varT());</div><div class="line">  fail_if_not(unittest_varops());</div><div class="line">  fail_if_not(unittest_array());</div><div class="line">  fail_if_not(unittest_func());</div><div class="line">  fail_if_not(unittest_arrayfunc());</div><div class="line"></div><div class="line">  fail_if_not(unittest_ptrmeta&lt;std::string&gt;());</div><div class="line">  fail_if_not(unittest_ptrmeta&lt;int**&gt;());</div><div class="line">  fail_if_not(unittest_ptrmeta&lt;char*******&gt;());</div><div class="line"></div><div class="line">  fail_if_not(unittest_templatemeta());</div><div class="line"></div><div class="line">  system(<span class="stringliteral">&quot;pause&quot;</span>);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
